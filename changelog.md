# 更新日志

## [1.1.0] - 2025-07-22

本次更新是一次重大版本升级，引入了强大的排除选择器功能，重构了核心翻译逻辑，并对 AI 引擎管理、选项页面体验和整体性能进行了全面增强和优化。

### ✨ 新增功能 (Features)

- **排除选择器 (Exclude Selectors)**: 新增全局和域名级别的排除选择器，允许用户精确地跳过对特定元素（如代码块、导航栏）的翻译。
- **更智能的元素识别**: 完全重构了元素查找逻辑 (`findTranslatableElements`)，能够更精确地识别和处理复杂页面布局中的“孤立”文本节点，确保了翻译内容的完整性，不再遗漏 `<i>`, `<b>` 等内联格式化标签。
- **AI 引擎增强**:
    - 新增 AI 引擎配置的导入和复制功能，方便用户分享和备份。
    - AI 连接测试功能现在支持使用自定义文本进行测试，以获得更真实的测试结果。
- **选项页面体验优化**:
    - 弹窗（如域名规则、AI引擎配置）在每次打开时会自动重置滚动条到顶部。
    - 规则和 AI 引擎的保存操作现在是原子化的，并提供了更清晰的错误处理。
    - 为字幕翻译设置添加了“禁用时保留设置”的选项，提升了用户体验。
- **加载指示器**: 实现了基于 SVG 遮罩的全新加载动画，并支持根据用户的系统偏好（`prefers-reduced-motion`）减少动态效果。
- **DOMWalker 增强**: `DOMWalker` 现在支持可配置的块级/行内元素类型判断，提高了翻译布局的准确性。
- **追加策略 (Append Strategy) 增强**: 优化了对块级元素的检测，使追加模式下的格式更可靠。
- **Popup 增强**: 在弹出窗口中添加了“关于”按钮，方便用户访问项目的 GitHub 仓库。

### 🚀 优化与重构 (Optimizations & Refactoring)

- **DOMWalker 性能优化**: 优化了 `DOMWalker` 的空白字符处理、元素排除匹配逻辑和节点克隆方式，提升了性能。
- **Google 翻译器**: 将 Google 翻译的 API 请求切换为 POST 方法，以支持更长的文本翻译。
- **代码质量提升**:
    - 统一了 `escapeHtml` 等工具函数，移除了多个文件中的重复实现。
    - 改进了弹窗的滚动行为和整体布局，并更新了追加文本的引用样式。

### 🐞 缺陷修复 (Bug Fixes)

- **修复重复翻译问题**: 彻底解决了在嵌套元素（如 `<td>` 内包含 `<p>`）中，`append` 策略会导致翻译内容被重复追加的严重缺陷。
- **修复动态内容处理**: 修复了 `MutationObserver` 无法正确忽略由脚本自身生成的包裹元素（`data-foxlate-generated`）的问题，减少了不必要的性能开销，并提高了在动态加载内容页面（如无限滚动）上的稳定性。
- **错误处理增强**: 优化了内容脚本中的消息处理机制，现在会返回结构化的错误信息，避免了在浏览器控制台中出现未捕获的 Promise 拒绝警告。
- **AI 翻译器**: 为缺失 API Key 的情况添加了本地化的错误提示。

### 📝 文档 (Documentation)

- 新增了此 `changelog.md` 文件，以记录未来的版本变更。
- 更新了 README 和 i18n 文本，以阐明新功能。

---